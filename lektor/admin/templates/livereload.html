<script type="text/javascript">
  (function () {
    if (window.self !== window.top) {
      return;
    } // We do not enable livereloading inside an iframe.
    const workerScriptPath = "{{ url_for('livereload.worker_script') }}";
    const eventsPath = "{{ url_for('livereload.events') }}";
    const currentFile = {{ artifact_name|tojson }};
    if (!currentFile) {
      return;
    }

    if (!window.SharedWorker) {
      console.debug("ðŸ˜­ live-reload cannot work in this browser.");
    } else {
      const worker = new SharedWorker(workerScriptPath, {
        name: "live-reload",
      });

      worker.port.addEventListener("message", (event) => {
        const { type, path } = event.data;
        if (type === "restart" || type === "reload" && path === currentFile) {
          location.reload();
        }
      });

      worker.port.postMessage({
        type: "initialize",
        eventsPath,
      });

      worker.port.start();
    }
  })();
</script>
